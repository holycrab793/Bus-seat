<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>45ì¸ìŠ¹ ë²„ìŠ¤ ì¢Œì„ ë°°ì¹˜ë„</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 10px;
    }
    .container {
      max-width: 480px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 15px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
      font-size: 24px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 20px;
    }
    button {
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .save-btn { background: #10b981; color: white; }
    .save-btn:hover { background: #059669; transform: translateY(-2px); }
    .clear-btn { background: #ef4444; color: white; }
    .clear-btn:hover { background: #dc2626; transform: translateY(-2px); }
    .share-btn { background: #3b82f6; color: white; }
    .share-btn:hover { background: #2563eb; transform: translateY(-2px); }
    .download-btn { background: #8b5cf6; color: white; }
    .download-btn:hover { background: #7c3aed; transform: translateY(-2px); }

    .bus {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 15px 10px;
      position: relative;
    }
    .driver-row {
      display: flex;
      gap: 6px;
      margin-bottom: 15px;
      align-items: center;
    }
    .driver-seat {
      flex: 1;
      background: #1f2937;
      color: white;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
    }
    .door {
      flex: 1;
      background: #f59e0b;
      color: white;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
    }
    .row {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      align-items: center;
    }
    .row-number {
      width: 25px;
      text-align: center;
      font-weight: 600;
      color: #6b7280;
      font-size: 13px;
      flex-shrink: 0;
    }
    .seats-left, .seats-right {
      display: flex;
      gap: 6px;
      flex: 1;
    }
    .aisle {
      width: 15px;
      text-align: center;
      color: #d1d5db;
      font-size: 11px;
    }
    .seat {
      flex: 1;
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 18px 2px;
      text-align: center;
      font-size: 14px;
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
      min-width: 55px;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .seat:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }
    .seat input {
      width: 100%;
      border: none;
      background: transparent;
      text-align: center;
      font-size: 16px;
      outline: none;
      font-family: inherit;
      font-weight: 600;
      padding: 0;
      letter-spacing: -0.5px;
    }
    .seat.filled {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
    }
    .seat.filled input { color: white; font-weight: 600; }
    .seat.filled input::placeholder { color: rgba(255, 255, 255, 0.6); }

    .seat-number {
      position: absolute;
      top: 2px;
      left: 4px;
      font-size: 9px;
      color: #9ca3af;
    }
    .seat.filled .seat-number { color: rgba(255, 255, 255, 0.7); }

    .last-row {
      display: flex;
      gap: 8px;
      margin-top: 20px;
    }
    .last-row .seat { flex: 1; }

    .status {
      text-align: center;
      margin-top: 15px;
      padding: 10px;
      background: #f0fdf4;
      border-radius: 10px;
      font-size: 14px;
      color: #166534;
    }
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: white;
      padding: 12px 24px;
      border-radius: 10px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .toast.show { opacity: 1; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸšŒ 45ì¸ìŠ¹ ë²„ìŠ¤ ì¢Œì„ë°°ì¹˜</h1>
    <p class="subtitle">ì¢Œì„ì„ í´ë¦­í•˜ì—¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</p>

    <div class="controls">
      <button class="save-btn" onclick="saveSeating()">ğŸ’¾ ì €ì¥</button>
      <button class="clear-btn" onclick="clearAll()">ğŸ—‘ï¸ ì‚­ì œ</button>
      <button class="share-btn" onclick="shareSeatingImage()">ğŸ”— ê³µìœ </button>
      <button class="download-btn" onclick="shareSeatingImage()">ğŸ“· ì‚¬ì§„ì €ì¥</button>
    </div>

    <div class="bus">
      <div class="driver-row">
        <div class="row-number"></div>
        <div class="driver-seat">ğŸš— ìš´ì „ì„</div>
        <div class="aisle"></div>
        <div class="door">ğŸšª ë¬¸</div>
      </div>

      <div id="bus-seats"></div>
    </div>

    <div class="status" id="status">
      íƒ‘ìŠ¹ì¸ì›: <strong>0</strong>/45ëª…
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    let seatData = {};
    let seatCounter = 1;

    function init() {
      const busSeats = document.getElementById('bus-seats');

      for (let row = 1; row <= 10; row++) {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'row';

        const rowNum = document.createElement('div');
        rowNum.className = 'row-number';
        rowNum.textContent = row;
        rowDiv.appendChild(rowNum);

        const seatsLeft = document.createElement('div');
        seatsLeft.className = 'seats-left';
        for (let i = 0; i < 2; i++) seatsLeft.appendChild(createSeat(seatCounter++));
        rowDiv.appendChild(seatsLeft);

        const aisle = document.createElement('div');
        aisle.className = 'aisle';
        aisle.textContent = 'ğŸš¶';
        rowDiv.appendChild(aisle);

        const seatsRight = document.createElement('div');
        seatsRight.className = 'seats-right';
        for (let i = 0; i < 2; i++) seatsRight.appendChild(createSeat(seatCounter++));
        rowDiv.appendChild(seatsRight);

        busSeats.appendChild(rowDiv);
      }

      const lastRowContainer = document.createElement('div');
      lastRowContainer.style.marginTop = '20px';

      const lastRowNum = document.createElement('div');
      lastRowNum.className = 'row-number';
      lastRowNum.textContent = '11';
      lastRowNum.style.marginBottom = '8px';
      lastRowNum.style.textAlign = 'center';
      lastRowContainer.appendChild(lastRowNum);

      const lastRow = document.createElement('div');
      lastRow.className = 'last-row';
      for (let i = 0; i < 5; i++) lastRow.appendChild(createSeat(seatCounter++));
      lastRowContainer.appendChild(lastRow);
      busSeats.appendChild(lastRowContainer);

      loadSeating();
      updateStatus();
    }

    function createSeat(number) {
      const seat = document.createElement('div');
      seat.className = 'seat';
      seat.dataset.seat = number;

      const seatNum = document.createElement('div');
      seatNum.className = 'seat-number';
      seatNum.textContent = number;
      seat.appendChild(seatNum);

      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'ì¢Œì„ ' + number;
      input.dataset.seat = number;

      input.addEventListener('input', (e) => {
        const value = e.target.value.trim();
        if (value) {
          seat.classList.add('filled');
          seatData[number] = value;
        } else {
          seat.classList.remove('filled');
          delete seatData[number];
        }
        updateStatus();
      });

      seat.appendChild(input);
      return seat;
    }

    function saveSeating() {
      try {
        localStorage.setItem('bus-seating', JSON.stringify(seatData));
        showToast('ğŸ’¾ ì¢Œì„ ë°°ì¹˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      } catch (e) {
        console.error('Storage error:', e);
        showToast('âš ï¸ ì €ì¥ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }

    function loadSeating() {
      try {
        const dataStr = localStorage.getItem('bus-seating');
        if (!dataStr) return;

        seatData = JSON.parse(dataStr) || {};
        Object.keys(seatData).forEach(seatNum => {
          const input = document.querySelector(`input[data-seat="${seatNum}"]`);
          if (input) {
            input.value = seatData[seatNum];
            input.parentElement.classList.add('filled');
          }
        });

        updateStatus();
      } catch (e) {
        console.error('Load error:', e);
      }
    }

    function clearAll() {
      if (!confirm('ì •ë§ë¡œ ëª¨ë“  ì¢Œì„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      seatData = {};
      document.querySelectorAll('.seat input').forEach(input => {
        input.value = '';
        input.parentElement.classList.remove('filled');
      });

      try { localStorage.removeItem('bus-seating'); } catch (e) {}

      updateStatus();
      showToast('ğŸ—‘ï¸ ëª¨ë“  ì¢Œì„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // âœ… ê³µìœ /ì‚¬ì§„ì €ì¥ í†µì¼: ì´ë¯¸ì§€ ìƒì„± í›„ ê³µìœ  ì‹œíŠ¸ë§Œ ë„ì›€
    async function shareSeatingImage() {
      try {
        showToast('ğŸ“· ì´ë¯¸ì§€ ìƒì„±ì¤‘...');

        const container = document.querySelector('.container');
        const canvas = await html2canvas(container, {
          backgroundColor: '#ffffff',
          scale: 2,
          logging: false
        });

        const blob = await new Promise((resolve, reject) => {
          canvas.toBlob(b => (b ? resolve(b) : reject(new Error('toBlob failed'))), 'image/png');
        });

        const date = new Date().toISOString().slice(0,10);
        const file = new File([blob], `ë²„ìŠ¤ì¢Œì„ë°°ì¹˜_${date}.png`, { type: 'image/png' });

        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
          await navigator.share({
            title: '45ì¸ìŠ¹ ë²„ìŠ¤ ì¢Œì„ë°°ì¹˜',
            text: 'ê³µìœ  ë©”ë‰´ì—ì„œ â€œì‚¬ì§„ì— ì €ì¥â€ì„ ì„ íƒí•˜ì„¸ìš”.',
            files: [file]
          });
          showToast('âœ… ê³µìœ  ë©”ë‰´ì—ì„œ â€œì‚¬ì§„ì— ì €ì¥â€ì„ ì„ íƒí•˜ì„¸ìš”.');
          return;
        }

        showToast('âš ï¸ ì´ ë¸Œë¼ìš°ì €ëŠ” íŒŒì¼ ê³µìœ ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. iPhoneì€ Safari, AndroidëŠ” Chrome ê¶Œì¥');
      } catch (error) {
        console.error('shareSeatingImage error:', error);
        showToast('âš ï¸ ì´ë¯¸ì§€ ìƒì„±/ê³µìœ  ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }

    function updateStatus() {
      const filledSeats = Object.keys(seatData).length;
      document.getElementById('status').innerHTML =
        `íƒ‘ìŠ¹ì¸ì›: <strong>${filledSeats}</strong>/45ëª…`;
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ìë™ì €ì¥: ì¢Œì„ inputì—ì„œë§Œ ë™ì‘
    let saveTimeout;
    document.addEventListener('input', (e) => {
      if (!(e.target && e.target.matches && e.target.matches('#bus-seats input'))) return;

      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(() => saveSeating(), 1000);
    });

    init();
  </script>
</body>
</html>
